# MNDT-2024-0008

## Description
Server-Side Request Forgery (“SSRF”) in the export dashboard functionality of Lightdash version 0.1024.6 allows remote authenticated threat actors to obtain the session cookie of any user who exports a crafted dashboard. When they are exported, dashboards containing HTML elements can trigger HTTP requests to an external domain that contain the exporting user’s session cookie. The cookie could be stolen by a threat actor and used to hijack application user sessions.

## Impact
Very High: Exploitation of this vulnerability could lead to user session compromise and allow a threat actor to take over user sessions. If an administrative user is targeted the threat actor could gain administrative control over the Lightdash instance. 

## Exploitability
Medium: A threat actor must be authenticated to the application and possess the necessary permissions to create or edit a dashboard and inject a payload. Any user exporting the dashboard can trigger the vulnerability. 

## CVE ID
CVE-2024-6586

## Common Weakness Enumeration
CWE-201 Insertion of Sensitive Information Into Sent Data

## Common Vulnerability Scoring System
CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N

## Technical Details
Lightdash version 0.1024.6 allows users with the necessary permissions, such as Administrator or Editor, to create and share dashboards. A dashboard that contains HTML elements which point to a threat actor controlled source can trigger an SSRF request when exported, via a POST request to /api/v1/dashboards/<dashboard identifier>/export. The forged request contains the value of the exporting user’s session token. A threat actor could obtain the session token of any user who exports the dashboard. The obtained session token can be used to perform actions as the victim on the application, resulting in session takeover. 

## Resolution
The issue was fixed in version 0.1027.2.

## Discovery Credits
Kenneth Chiong, Mandiant

## Disclosure Timeline
* March 7, 2024 - Vulnerability disclosed to vendor
* March 8, 2024 - Vulnerability was patched

References
* https://www.cve.org/CVERecord?id=CVE-2024-6586
* https://github.com/lightdash/lightdash
* https://github.com/lightdash/lightdash/releases/tag/0.1027.2
* https://patch-diff.githubusercontent.com/raw/lightdash/lightdash/pull/9295.patch
* https://github.com/lightdash/lightdash/pull/9295
* https://github.com/google/security-research/security/advisories/GHSA-4h7x-6vxh-7hjf
