# MNDT-2024-0007

## Description
Multiple stored cross-site scripting (“XSS”) vulnerabilities in the markdown dashboard and dashboard comment functionality of Lightdash version 0.1024.6 allows remote authenticated threat actors to inject malicious scripts into vulnerable web pages. A threat actor could potentially exploit this vulnerability to store malicious JavaScript which executes in the context of a user’s session with the application. 

## Impact
High: Exploitation of this vulnerability could allow a threat actor to impersonate a user through request forgery, session hijacking, or an account takeover. In addition, a threat actor could access or exfiltrate any data the victim user can access. 

## Exploitability
Medium: A threat actor needs permissions to create dashboards and make dashboard comments, such as those granted with the Administrator or Editor roles. The threat actor must only identify the affected scope, submit the XSS payload, and wait for an unsuspecting user to visit the affected page. The application contains functionality to tag users and notify them of new comments, which increases the likelihood of a user browsing to a page and triggering payload execution. 

## CVE ID
CVE-2024-6585

## Common Weakness Enumeration
CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

## Common Vulnerability Scoring System
CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N

## Technical Details
Lightdash version 0.1024.6 allows users with the permissions to edit a dashboard or submit a dashboard comment to inject arbitrary JavaScript via the content parameter when saving a dashboard or the textHtml parameter when submitting a dashboard comment. The injected statements execute when viewing the respective dashboard or comment, leading to stored XSS. A threat actor could store a payload and wait for a user to browse to the page with the injected content to execute arbitrary JavaScript in the context of that user’s application session.

## Resolution
The issue was fixed in version 0.1042.2. 

## Discovery Credits
Kenneth Chiong, Mandiant

## Disclosure Timeline
* March 7, 2024 - Vulnerability disclosed to vendor
* March 26, 2024 - Vulnerability was patched

## References
* https://www.cve.org/CVERecord?id=CVE-2024-6585 
* https://github.com/lightdash/lightdash
* https://github.com/lightdash/lightdash/releases/tag/0.1042.2
* https://patch-diff.githubusercontent.com/raw/lightdash/lightdash/pull/9510.patch
* https://github.com/lightdash/lightdash/pull/9510
* https://patch-diff.githubusercontent.com/raw/lightdash/lightdash/pull/9359.patch
* https://github.com/lightdash/lightdash/pull/9359
* https://github.com/google/security-research/security/advisories/GHSA-6529-6jv3-66q2
